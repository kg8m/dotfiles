[init]
# http://klabgames.tech.blog.jp.klab.com/archives/1033121546.html
templatedir = ~/.git_templates/

[color]
branch = auto
diff   = auto
status = auto

[color "branch"]
current = white red
local   = yellow
remote  = green

[color "diff"]
meta = green
frag = magenta bold
old  = cyan
new  = red

[color "status"]
added     = yellow
changed   = green
untracked = cyan

[color]
ui = true

[core]
whitespace=fix,-indent-with-non-tab,trailing-space,cr-at-eol
editor = vim
excludesfile = ~/.gitignore

[branch]
autosetupmerge = true

[alias]
# base
aliases = !git alias
alias   = !git config --get-regexp '^alias\\.' | sed -e 's/alias\\.\\([^ ]*\\) \\(.*\\)/\\1\\\t => \\2/' | sort -k3

info = remote show origin
st   = status

chmod = "!f() {\
  command=\"git update-index --add --chmod=$@\";\
  git execute-with-echo ${command};\
}; f"

# clone
clone-with-submodules = clone --recursive

# checkout
co = checkout

cop = "!f() {\
  local branch=$( git select-a-branch );\
  [[ \"${branch}\" ]] && git execute-with-echo \"git checkout ${branch}\";\
}; f"

# pull/fetch/merge/rebase
up = !git update
f  = fetch

update = "!f() {\
  remote_branch=$( git rev-parse --abbrev-ref '@{u}' );\
  git execute-with-echo 'git --no-pager show --no-patch';\
  echo;\
  git execute-with-echo 'git fetch';\
  echo;\
  git execute-with-echo 'git --no-pager log --reverse HEAD.. '${remote_branch};\
  echo;\
  git execute-with-echo 'git pull --stat --rebase || echo \"Error: rebase aborted!!\"';\
}; f"

# branch
brs      = !git branches
br       = branch
branches = branch -avv

delete-fully-merged-local-branch = branch --delete

create-branch = "!f() {\
  original_branch=$1;\
  branch_name=$2;\
  commit_messages=$3;\
  \
  command=\"git checkout -b ${branch_name} ${original_branch}\";\
  command=${command}\" && git commit --allow-empty --message='${commit_messages}'\";\
  command=${command}\" && git push -u origin ${branch_name}\";\
  command=${command}\"; git branches\";\
  \
  git execute-with-confirm ${command};\
}; f"

delete-local-branches  = "!f() {\
  branches=$( git branch | filter );\
  command=\"for branch in ${branches}; do git branch -D \\${branch}; done\";\
  echo 'Selected branches:';\
  for branch in ${branches}; do\
    echo \"  - ${branch}\";\
  done;\
  git execute-with-confirm ${command};\
  git branches;\
}; f"

delete-remote-branches = "!f() {\
  branches=$( git branch -r | filter | awk '{ print $1 }' | sed -e 's/^origin\\///' );\
  command=\"for branch in ${branches}; do git push --delete origin \\${branch}; done\";\
  echo 'Selected branches:';\
  for branch in ${branches}; do\
    echo \"  - ${branch}\";\
  done;\
  git execute-with-confirm ${command};\
  git branches;\
}; f"

select-a-branch = "!f() {\
  prompt=${1:-'select a branch:'};\
  branches=($( git branch -a | sed -e 's/^[* ] //' | sed -e 's/remotes\\/origin\\///' | egrep -v '\\->' | sort | uniq | filter --prompt \"${prompt}\" ));\
  \
  if [[ ! ${#branches[@]} -eq 1 ]]; then\
    echo 'select only 1 branch.' >&2;\
    exit 1;\
  else\
    echo ${branches};\
  fi;\
}; f"

select-a-remote-branch = "!f() {\
  prompt=${1:-'select a branch:'};\
  branches=($( git branch -r | awk '{print $1}' | filter --prompt \"${prompt}\" ));\
  \
  if [[ ! ${#branches[@]} -eq 1 ]]; then\
    echo 'select only 1 branch.' >&2;\
    exit 1;\
  else\
    echo ${branches};\
  fi;\
}; f"

# commit
ci = commit
ca = commit --all

# reset/revert
edit-commits      = "!f() { git rebase --interactive HEAD~$1; }; f"
reset-commits     = !git edit-commits
reset-last-commit = reset --soft HEAD~
undo-add          = reset --soft

# log
lg    = !git graph
graph = log --graph --pretty=format:\"%Cgreen%h %ci %Cblue%an %Creset%s\"
la    = log --branches --tags --remotes
lp    = log --stat --patch

lg-branches = !git log-branches --graph --pretty=format:'%Cgreen%h\\ %ci\\ %Cblue[C]\\ %cn\\ [A]\\ %an\\ %Creset%s'
lp-branches = !git log-branches --stat --patch

log-branches = "!f() {\
  branch1=$( git select-a-remote-branch 'select first branch:' ) || exit 1;\
  branch2=$( git select-a-remote-branch 'select another branch:' ) || exit 1;\
  \
  command=\"git log $@ ${branch1}...${branch2}\";\
  git execute-with-confirm ${command};\
}; f"

# diff
di = !git diff-without-space-changes
dc = !git diff-without-space-changes --cached
ds = !git diff-without-space-changes --staged
dw = !git diff-without-space-changes --color-words
dh = !git diff-without-space-changes HEAD
dl = !git diff-local-without-space-changes

diff-without-space-changes = diff --ignore-all-space --ignore-blank-lines --ignore-space-at-eol --ignore-space-change
diff-local = diff --no-index
diff-local-without-space-changes = !git diff-without-space-changes --no-index

diff-stat-branches  = !git diff-branches --stat-width = 150

diff-branches = "!f() {\
  branch1=$( git select-a-remote-branch 'select first branch:' ) || exit 1;\
  branch2=$( git select-a-remote-branch 'select another branch:' ) || exit 1;\
  \
  command=\"git diff-without-space-changes $@ ${branch1}...${branch2}\";\
  git execute-with-confirm ${command};\
}; f"

diff-branch-from = "!f() {\
  target=$1;\
  \
  if [[ ! \"${target}\" ]]; then\
    echo 'Specify branch (e.g., \"master\")' >&2;\
    exit 1;\
  fi;\
  \
  current=$( git rev-parse --abbrev-ref '@{upstream}' );\
  command=\"git diff-without-space-changes ${@:2:($#-1)} origin/${target}...${current}\";\
  git execute-with-confirm ${command};\
}; f"

open-changed-files-from = "!f() {\
  target=$1;\
  \
  if [[ ! \"${target}\" ]]; then\
    echo 'Specify branch (e.g., \"master\")' >&2;\
    exit 1;\
  fi;\
  \
  current=$( git rev-parse --abbrev-ref '@{upstream}' );\
  command=\"vim \\$( git diff --name-only ${@:2:($#-1)} origin/${target}...${current} )\";\
  git execute-with-confirm ${command};\
}; f"

# show
show-without-diff = show -s

# submodule
update-submodules = !git execute-with-echo 'git submodule update --remote --rebase && git status'

# hook
update-hooks = !( rm -i .git/hooks/* || exit 0 ) && cp ~/.git_templates/hooks/* .git/hooks/ && ls -l .git/hooks/

# utility
execute-with-echo = "!f() {\
  command=\"$@\";\
  echo '# '${command};\
  eval ${command};\
}; f"

execute-with-confirm = "!f() {\
  command=\"$@\";\
  echo '# '${command};\
  read -p 'Are you sure? [y/n]: ' response;\
  \
  if [[ ${response} =~ ^y ]]; then\
    eval ${command};\
  else\
    echo 'aborted.' >&2;\
  fi;\
}; f"

[github]
user = kg8m

[diff]
algorithm = patience
context = 10
compactionHeuristic = true
colorMoved = dimmed_zebra

[fetch]
prune = true

[pull]
rebase = true

[rerere]
enabled = true

[user]
name  = kg8m
email = takumi.kagiyama@gmail.com
useConfigOnly = true

[submodule]
fetchJobs = 4

[pager]
log  = diff-highlight | less --LINE-NUMBERS
show = diff-highlight | less --LINE-NUMBERS
diff = diff-highlight | less --LINE-NUMBERS

[interactive]
diffFilter = diff-highlight

[commit]
verbose = true
cleanup = scissors

[rebase]
autostash = true
showCurrentPatch = true

[status]
showUntrackedFiles = all

[include]
path = ~/.gitconfig.local
