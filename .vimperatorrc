"" vim: set ft=vimperator:

" ------------------------------------------------------------
" 基本設定
" ------------------------------------------------------------

colorscheme solarized

" ブラウザのタイトル
set titlestring="Mozilla Firefox"

" キャレットを太めに
set! ui.caretWidth=7

" ページのアクセスキーを無効化
set! ui.key.generalAccessKey=0

" 検索語のハイライト
set hlsearch

" Beep設定オフ
set visualbell
highlight Bell display: none;

" 補完設定
set autocomplete
set complete=sl

" クイックリンク関連
set hintchars=fjklasdhguionmerwc
highlight Hint font-family: "Osaka－等幅", "Osaka-Mono"; padding: 1px 3px; border: 1px solid #fdf6e3; background-color: #d33682; color: #fdf6e3; font-size: 12.5px; font-weight: normal; text-transform: uppercase; white-space: nowrap;

" Next/Previous Link
set nextpattern=\bnext\b,\bmore\b,^next$,^次(の)?ページ,\b次.*,^次へ$,→\b,^>$,^(>>|≫)$,^(>|≫),(>|≫)$
set previouspattern=\bprev|previous\b,^prev$,^前(の)?ページ,\b前.*,^前へ$,\b←,^<$,^(<<|≪)$,^(<|≪),(<|≪)$

" IME Controller
:style -name commandline-ime chrome://* #liberator-commandline-command input { ime-mode: inactive; }

" エディタ
" It's All Text!のホットキーが<C-q>
set editor=C:/Shortcuts/gvim73.lnk
inoremap <C-q> <Ins><C-q><Ins>


" ------------------------------------------------------------
" キーマップ設定
" ------------------------------------------------------------

let mapleader = ","

" ,r で .vimperatorrc をリロード
nnoremap <Leader>r :source ~/.vimperatorrc<Cr>

" 検索補完関連
nnoremap s :set<Space>cpt=s<Cr>:open<Space>google<Space>
nnoremap S :set<Space>cpt=s<Cr>:tabopen<Space>google<Space>
nnoremap a :set<Space>cpt=s<Cr>:open<Space>amazon<Space>
nnoremap A :set<Space>cpt=s<Cr>:tabopen<Space>amazon<Space>
nnoremap t :set<Space>cpt=slt<Cr>:tabopen<Space>
nnoremap o :set<Space>cpt=slt<Cr>:open<Space>

" URL中の数字を++/--
noremap + <C-a>
javascript << EOM
mappings.addUserMap(
  [modes.NORMAL],
  ["-"],
  "- to <C-x>",
  function() { events.feedkeys("<C-x>", true); },
  { rhs: "<C-x>", noremap: true }
);
EOM

" タブ移動（タブからタブへの移動ではなく、タブの位置変更）
nnoremap <C-S-j> :tabmove +1<Cr>
nnoremap <C-S-k> :tabmove -1<Cr>

" OSのキーバインドを一部再現
inoremap <C-a> <Ins><C-a><Ins>
inoremap <C-w> <Ins><C-w><Ins>
cnoremap <C-a> <Ins><C-a><Ins>

" ソース表示
nnoremap <C-S-u> i<C-u>

" ロケーションバーにフォーカス
noremap <C-l> <A-d>

" 誤操作防止
inoremap <C-n> <Esc><C-n>
inoremap <C-p> <Esc><C-p>

" input で Ctrl + h/j/k/l を使って移動
" use OS's settings or key-config applications, e.g., KeyRemap4MacBook
" inoremap <C-h> <Left>
" inoremap <C-j> <Down>
" inoremap <C-k> <Up>
" inoremap <C-l> <Right>
inoremap <C-f> <PageDown>
inoremap <C-b> <PageUp>

" 別タブでページ内検索したワードを引き継ぐ
" n/N でも全部ハイライトさせる
" FirefoxProfileDir/extensions/vimperator@mozdev.org/common/content/finder.js
" needs to be fixed if Vimperator's core codes change
javascript << EOM
  finder.__originalFind__ = finder.find;
  finder.find = function(str) {
    this.__originalFind__(str);
    this.__lastSearchString__ = str;
  };

  finder.__originalFindAgain__ = finder.findAgain;
  finder.findAgain = function(reverse) {
    if (options["hlsearch"]) {
      this.highlight(this.__lastSearchString__);
    }

    if (!this.findbar._findField.value) {
      this.findbar._findField.value = this.__lastSearchString__;
    }

    this.__originalFindAgain__(reverse);
  };
EOM

" <Esc><Esc>で検索ハイライト解除
nnoremap <Esc><Esc> :noh<Cr>

" ,p で印刷プレビュー
nnoremap <Leader>p :emenu ファイル.印刷プレビュー<Cr>

" ,o でURLを一気に開く
nnoremap <Leader>o :emenu ファイル.Open Multiple Locations...<Cr>


" ------------------------------------------------------------
" プラグイン関連
" ------------------------------------------------------------

" for _smooziee.js
" default = [400, 20]
let g:smooziee_scroll_amount=350
let g:smooziee_scroll_interval=25

" for amazon_simple_uri.js
" なんてあさましいっ!!
let g:amazon_asamashi = "kgtk-22"

" for caret-hint
nnoremap <Leader>f :caret move head<Cr>
nnoremap <Leader>F :caret move tail<Cr>

" for copy.js
javascript << EOM
liberator.globalVariables.copy_templates = [
  { label: 'urlWithoutEncode', value: 'copy the URL without encoding',
    custom: function(){ return buffer.URL },                         map: 'yy' },
  { label: 'titleAndURL',      value: '%TITLE%\n%URL%',              map: '<S-y>' },
  { label: 'title',            value: '%TITLE%',                     map: ',y' },
  { label: 'anchor',           value: '<a href="%URL%">%TITLE%</a>', map: ',ya' },
  { label: 'selanchor',        value: '<a href="%URL%" title="%TITLE%">%SEL%</a>' },
  { label: 'htmlblockquote',   value: '<blockquote cite="%URL%" title="%TITLE%">%HTMLSEL%</blockquote>' },
  { label: 'ASIN',             value: 'copy ASIN code from Amazon',
    custom: function(){ return content.document.getElementById('ASIN').value; }},

  { label: 'blockquoteForMe', value: '<blockquote>\n  %HTMLSEL%\n</blockquote>\n<p class="p-cite"><cite>From: <a href="%URL%">%TITLE%</a></cite></p>' },
  { label: 'kinikijiAnchor',  value: '<p class="p-news">&raquo;&nbsp;<a href="%URL%">%TITLE%</a></p>' },
  { label: 'amazonForMe',     value: 'Copied: Amazon Affiliate Link',
    custom: function(){ return '<a href="http://www.amazon.co.jp/o/ASIN/' + content.document.getElementById('ASIN').value + '/kgtk-22/" class="amazon">' + content.document.title + '</a>'; }
  },
  { label: 'amazonMarkdown',  value: 'Copied: Amazon Affiliate Link for Markdown',
    custom: function(){ return '[' + content.document.title + '](http://www.amazon.co.jp/o/ASIN/' + content.document.getElementById('ASIN').value + '/kgtk-22/)'; }
  },
  { label: 'tracLink',     value: '[%URL% %TITLE%]',  map: ',yt' },
  { label: 'markdownLink', value: '[%TITLE%](%URL%)', map: ',ym' },
];
EOM

" for feedSomeKeys_3.js
command! -nargs=+ lazy autocmd VimperatorEnter .* <args>
lazy fmaps -u='mail\.google\.com/mail' c / y f j k n p o u e x r a t # [ ] z * ? gl gi gs gt gd ga gc
lazy fmaps -u='(calendar\.google\.com|www\.google\.com/calendar)' -events=vkeydown t a d w m x c e / + q ? j k r
lazy fmaps -u='(calendar\.google\.com|www\.google\.com/calendar)' -events=keydown <Del> <Bs>
lazy fmaps -u='feedly\.com' ? gh ga gg <S-j> <S-k> r j k n p o v m <S-v>
lazy fmaps -u='www\.flickr\.com' -events=vkeydown ? l j k
lazy fmaps -u='www\.flickr\.com' -events=keydown <Left> <Right>
lazy fmaps -u='www\.gqueues\.com/main' -events=vkeydown ? j k h l <S-j> <S-k> q r / e n <S-c> s d <C-S-d> o <S-o> gi
lazy fmaps -u='www\.gqueues\.com/main' -events=keydown <Left> <Right>
lazy fmaps -u='chrome://newsfox/content/newsfox\.xul' r m v

" for twittperator
let g:twittperator_use_ssl_connection_for_api_ep = 1

" for websearch.js
javascript <<EOM
liberator.globalVariables.webSearchTemplates = [
  {
    names:       ['weblio'],
    description: 'Translate keywords by weblio',
    url:         'http://ejje.weblio.jp/content/%KEYWORD%',
  },
  {
    names:             ['ruby'],
    description:       'Search Ruby documents on APIdock',
    url:               'http://apidock.com/ruby/search?query=%KEYWORD%',
    urlWithoutKeyword: 'http://apidock.com/ruby',
  },
  {
    names:             ['rails'],
    description:       'Search Rails documents on APIdock',
    url:               'http://apidock.com/rails/search?query=%KEYWORD%',
    urlWithoutKeyword: 'http://apidock.com/rails',
  },
  {
    names:             ['github'],
    description:       'Search keywords on Github',
    url:               'https://github.com/search?q=%KEYWORD%',
    urlWithoutKeyword: 'https://github.com/kg8m',
  },
];
EOM


" ------------------------------------------------------------
source ~/.vimperatorrc.local


" ------------------------------------------------------------
" settingsg after loadplugins
" ------------------------------------------------------------

loadplugins

" for hints-ext
" http://d.hatena.ne.jp/caisui/20110724/1311495886
" http://d.hatena.ne.jp/caisui/20120715/1342331929
" http://d.hatena.ne.jp/caisui/20130527/1369660189
" let use_hints_ext_hinttags = 1
" let use_hints_ext_extendedhinttags = 1
" let use_hints_ext_tranform = 1
" autocmd VimperatorEnter ".*" :highlight -append HintExt font-family: "Osaka－等幅", "Osaka-Mono"; border: 1px solid #fdf6e3; background-color: #d33682; color: #fdf6e3; font-size: 15px; font-weight: normal;
" javascript << EOM
" (function(){
"   // ページ送り
"   var _scrollPageWithHints = function(_mapping, _scrollPageSize){
"     hints.addSimpleMap(_mapping, function(){
"       this.hide();
"       buffer.scrollPages(_scrollPageSize);
"       this.show(this._submode, "", content.window);
"     });
"   };
"   _scrollPageWithHints("<C-f>", 1);
"   _scrollPageWithHints("<C-b>", -1);

"   // hint node 重なり除去
"   hints.addSimpleMap("<C-l>", function(){ this.relocation(); });
" })();
" EOM


" ------------------------------------------------------------
echo ".vimperatorrc sourced"
